<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Demandas - Affari</title>
<style>
html, body { height:100%; margin:0; padding:0; font-family:'Segoe UI', Arial; background:#fdfdfd; overflow:hidden; }
h1 { text-align:center; margin:8px 0; font-size:22px; }
.container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
  gap:10px; padding:10px; height:calc(100% - 60px); justify-items:center; align-items:start; overflow:hidden;
}
.card {
  background:#e0e0e0; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.15);
  padding:10px; width:100%; max-width:220px; min-height:260px; text-align:center;
  display:flex; flex-direction:column; justify-content:flex-start; font-size:12px; cursor:pointer; transition:0.3s;
}
.card.entregue { background-color:#c8e6c9; }
.logo { width:25%; max-width:50px; margin:0 auto 6px auto; opacity:0.9; }
h2 { font-size:14px; margin:4px 0; }
.info { font-size:12px; line-height:1.2; }
.itens, .observacoes { text-align:left; font-size:11px; margin-top:6px; border-top:1px solid #ccc; padding-top:4px; white-space:pre-line; }
.status { font-weight:bold; font-size:11px; margin-top:4px; }
.footer { text-align:center; font-size:11px; color:#888; position:absolute; bottom:5px; width:100%; }
.loading { text-align:center; color:#555; font-size:14px; margin-top:20px; }
@media(max-width:1400px){ .card{max-width:200px; min-height:240px;} }
@media(max-width:1000px){ .card{max-width:180px; min-height:220px;} }
@media(max-width:700px){ .container{grid-template-columns:repeat(2,1fr);} .card{max-width:90%; min-height:200px;} }
@media(max-width:500px){ h1{font-size:18px;} .card{font-size:10px;} }
</style>
</head>
<body>
<h1>Painel de Demandas - Affari</h1>
<div class="loading" id="loading">üîÑ Carregando dados da planilha...</div>
<div class="container" id="cards"></div>
<div class="footer">Atualizando automaticamente a cada 10 segundos</div>

<script>
async function carregarDados() {
    try {
        const res = await fetch("/dados");
        const registros = await res.json();
        const container = document.getElementById("cards");
        const loading = document.getElementById("loading");
        container.innerHTML = "";
        loading.style.display = "none";

        registros.slice(0,10).forEach(r=>{
            const card = document.createElement("div");
            card.className = "card" + (r.retirado ? " entregue" : "");
            const itensText = r.itens.map(i => i.quantidade + " " + i.item).join("<br>");
            card.innerHTML = `
                <img src="download.png" class="logo" alt="Affari logo">
                <h2>${r.secretaria}</h2>
                <div class="info">
                    <strong>Diretor:</strong> ${r.diretor}<br>
                    <strong>Local:</strong> ${r.local}<br>
                    <strong>Data:</strong> ${r.data}<br>
                    <strong>Hora:</strong> ${r.horario}<br>
                    <strong>Pax:</strong> ${r.pax}
                </div>
                <div class="itens"><strong>Itens:</strong><br>${itensText}</div>
                <div class="observacoes"><strong>Observa√ß√µes:</strong><br>${r.observacoes}</div>
                <div class="status">${r.status} ${r.retirado ? "‚Ä¢ Retirado" : ""}</div>
            `;

            card.onclick = async ()=>{
                if(!r.retirado){
                    await fetch("/confirmar",{
                        method:"POST",
                        headers:{"Content-Type":"application/json"},
                        body:JSON.stringify({id:r.id})
                    });
                    r.retirado = true;
                    card.classList.add("entregue");
                    card.querySelector(".status").textContent += " ‚Ä¢ Retirado";
                }
            };
            container.appendChild(card);
        });
    } catch(e){
        console.error("Erro ao carregar dados:", e);
        document.getElementById("loading").textContent = "‚ùå Erro ao carregar dados.";
    }
}

carregarDados();
setInterval(carregarDados,10000);
</script>
</body>
</html>
